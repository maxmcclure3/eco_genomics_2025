  ---
title: "nucleotide_diversity_HW"
author: "Max McClure"
date: "2025-09-23"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE) 
knitr::opts_knit$set(root.dir = "~/projects/eco_genomics_2025/population_genomics/myresults/homework1results")
```

Import our libraries for plotting

```{r}
library(ggplot2)
library(tidyverse)
library(ggpubr)
```

read in theta outputs

```{r}
theta_ST0 <- read.table("2032_ALL_ST0_win50000_step50000.thetas", header = TRUE, sep = "\t")

theta_ST1 <- read.table("2032_ALL_ST1_win50000_step50000.thetas", header = TRUE, sep = "\t")

theta_SMDI1 <- read.table("2032_ALL_SMDI1_win50000_step50000.thetas", header = TRUE, sep = "\t")

theta_SMDI2 <- read.table("2032_ALL_SMDI2_win50000_step50000.thetas", header = TRUE, sep = "\t")

theta_ST0_SMDI2 <- read.table("2032_ALL_ST0_SMDI2_win50000_step50000.thetas", header = TRUE, sep = "\t")
```

```{r}
theta_ST0$tWsite = theta_ST0$tW/theta_ST0$nSites
theta_ST0$tPsite = theta_ST0$tP/theta_ST0$nSites

theta_ST1$tWsite = theta_ST1$tW/theta_ST1$nSites
theta_ST1$tPsite = theta_ST1$tP/theta_ST1$nSites

theta_SMDI1$tWsite = theta_SMDI1$tW/theta_SMDI1$nSites
theta_SMDI1$tPsite = theta_SMDI1$tP/theta_SMDI1$nSites

theta_SMDI2$tWsite = theta_SMDI2$tW/theta_SMDI2$nSites
theta_SMDI2$tPsite = theta_SMDI2$tP/theta_SMDI2$nSites

theta_ST0_SMDI2$tWsite = theta_ST0_SMDI2$tW/theta_ST0_SMDI2$nSites
theta_ST0_SMDI2$tPsite = theta_ST0_SMDI2$tP/theta_ST0_SMDI2$nSites
```

```{r}
theta2_ST0 <- theta_ST0 %>%
  arrange(Chr, WinCenter) %>%
  filter(nSites > 100)

theta2_ST1 <- theta_ST1 %>%
  arrange(Chr, WinCenter) %>%
  filter(nSites > 100)

theta2_SMDI1 <- theta_SMDI1 %>%
  arrange(Chr, WinCenter) %>%
  filter(nSites > 100)

theta2_SMDI2 <- theta_SMDI2 %>%
  arrange(Chr, WinCenter) %>%
  filter(nSites > 100)

theta2_ST0_SMDI2 <- theta_ST0_SMDI2 %>%
  arrange(Chr, WinCenter) %>%
  filter(nSites > 100)
```

plotting histogram of total number of sites are in each seq window
```{r}
SitesPerWindowST0 <- ggplot(data = theta2_ST0, aes(x = nSites)) +
  geom_histogram(bins = 50, fill = "lightblue", color = "black") +
  geom_vline(xintercept = median(theta2_ST0$nSites), color = "red", linetype = "dashed") +
  labs(title = "Distribution of windows with data", x = "Number of sites in 50kb window", y = "Frequency")


SitesPerWindowST1 <- ggplot(data = theta2_ST1, aes(x = nSites)) +
  geom_histogram(bins = 50, fill = "lightblue", color = "black") +
  geom_vline(xintercept = median(theta2_ST1$nSites), color = "red", linetype = "dashed") +
  labs(title = "Distribution of windows with data", x = "Number of sites in 50kb window", y = "Frequency")

SitesPerWindowSMDI1 <- ggplot(data = theta2_SMDI1, aes(x = nSites)) +
  geom_histogram(bins = 50, fill = "lightblue", color = "black") +
  geom_vline(xintercept = median(theta2_SMDI1$nSites), color = "red", linetype = "dashed") +
  labs(title = "Distribution of windows with data", x = "Number of sites in 50kb window", y = "Frequency")

SitesPerWindowSMDI2 <- ggplot(data = theta2_SMDI2, aes(x = nSites)) +
  geom_histogram(bins = 50, fill = "lightblue", color = "black") +
  geom_vline(xintercept = median(theta2_SMDI2$nSites), color = "red", linetype = "dashed") +
  labs(title = "Distribution of windows with data", x = "Number of sites in 50kb window", y = "Frequency")

SitesPerWindowST0_SMDI2 <- ggplot(data = theta2_ST0_SMDI2, aes(x = nSites)) +
  geom_histogram(bins = 50, fill = "lightblue", color = "black") +
  geom_vline(xintercept = median(theta2_ST0_SMDI2$nSites), color = "red", linetype = "dashed") +
  labs(title = "Distribution of windows with data", x = "Number of sites in 50kb window", y = "Frequency")

ggarrange(SitesPerWindowST0, SitesPerWindowST1, 
          SitesPerWindowSMDI1, SitesPerWindowSMDI2,
          SitesPerWindowST0_SMDI2)
```

plot pi

```{r}

ggplot(theta2, aes(x=Chr, y = tPsite, color = Chr)) +
  geom_point(size = 0.75, shape = 8, show.legend = FALSE) +
  ylim(0,0.07) +
  labs(title = "Nucleotide diversity in 50kb windows for population 2032", x = "Scaffold", y = "Theta-pi")

```


```{r}
ggplot(theta2, aes(x = tWsite, y = tPsite, color = Chr)) +
  geom_point(size = 0.75, shape = 8, show.legend = FALSE) +
  labs(title = "theta w and theta pi plotted against each other", x = "theta-W", y = "theta-pi") + 
  geom_abline(slope = 1, intercept = 0, linetype = "dashed", color = "black")
```


which windows have evidence of negative D and low nucleotide diversity ?
 - looking for selective sweep (demographic change), entire genome alteration
```{r}
theta2[which(theta2$Tajima<-1.5 & theta2$tPsite < 0.001),]
summary(theta2)
```





```{r}
mu = 2.5*10^-9
gen.time = 30
C = 4
mean_tW <- mean(theta2$tWsite)
mean_tP <- mean(theta2$tPsite)

Ne_theta <- mean_tW / (mu*gen.time*C)
Ne_theta
Ne_pi <- mean_tP / (mu*gen.time*C)
Ne_pi


sum(theta2$nSites)


maxD = max(theta2$Tajima)
minD = min(theta2$Tajima)

BigD <- theta2[which(theta2$Tajima == maxD),]

SmallD = theta2[which(theta2$Tajima == minD),]
SmallD
```












